---

javascript: |

  function reset() {
    // empty and clear attributes
    document.body.innerHTML = '';
  }

  function elPath(string) {
    const pathParts = string.toLowerCase().split( '|' );
    
    if (pathParts.length === 0 || pathParts[0] !== 'body') {
      console.warn( "elPath path must start with body. that's just how it is" );
      return undefined;
    }

    let node = document.body;
    for (let i=1; i<pathParts.length; i++) {
      let [ pp, number, tag ] = pathParts[i].split( /^(\d+)[^a-z]*(.*)$/ );
      number = parseInt(number);
      const childel = node.children[number];
      if (childel && childel.tagName === tag.toUpperCase()) {
        node = childel;
      } else {
        return undefined;
      }
    }

    return node;
  } //elPath

  let ran = 0;
  let passes = 0;
  let fails = 0;

  function is( actual, expected, msg ) {
    if (actual === expected) {
      passes++;
      console.log( `passed: test '${msg}'` );
    } else {
      fails++;
      console.log( `failed: test '${msg}'. expected '${expected}' and got '${actual}'` );
    }
  }
  function pass (msg) {
    ran++;
    passes++;
    console.log( `passed: test '${msg}'` );
  }
  function fail (msg) {
    ran++;
    fails++;
    console.log( `FAILED: test '${msg}'` );
  }
  function doneTesting() {
    if (ran === passes) {
      console.log( `PASSED ALL ${ran} TESTS` );
    } else {
      console.log( `FAILED ${fails} of ${ran} TESTS` );
    }
  }
  function checkNode( path, expected_attrs, msg ) {
    const actualEl = elPath( path );
    if (! actualEl) {
      fail( `${msg} : html element not found` );
      return;
    }
    let passes = true;
    // check the expected attrs
    Object.keys( expected_attrs ).forEach( attr => {
      if (attr === 'textContent') {
        passes = passes && actualEl.textContent === expected_attrs[attr];
      } else {
        passes = passes && actualEl.getAttribute( attr ) === expected_attrs[attr];
      }
    } );
    if (passes) {
      pass( msg );
    } else {
      fail( msg );
    }

    return passes;
  }

  function el (tag, attrs, contents) {
    if (Array.isArray( attrs ) ) {
      contents = attrs;
      attrs = {};
    } else {
      if (typeof attrs !== 'object') {
        attrs = { textContent: attrs };
      }
      contents = contents || [];
    }
    const calculations = {};
    // check for calculations. if the attr is a number
    Object.keys( attrs ).forEach( attr => {
      if ( Number.isInteger( attrs[attr] ) ) {
        calculations[attr] = attrs[attr];
        delete attrs[attr];
      } 
    } );
    debugger;
    return { tag, attrs, contents, calculations };
  }

  // so we want to grab some json and compile it and stuff as a namespace, then attach it to the body
  function test() {
    reset();
    init( { TEST: 
            { html: { body: { contents: [ el( 'span', "FIRST" ),
                                          el( 'div', "SECOND",
                                              [
                                                el( 'foo' ),
                                                el( 'foo', { functions: { bar: 1 } } ),
                                              ] )
                                        ] } },
              components: {
                foo: {
                  functions: {
                    bar: 0
                  },
                  contents: [
                    el ( 'div', '', [
                      el ('span', { textContent: 2 } ),
                    ] ),
                  ],
                },
              },
            },
          },
          [ c => "BAR",
            c => "BAR2",
            c => {debugger;return c.fun.foo()},
          ],
          'TEST'
        );
    checkNode( "body|0 span", { textContent: 'FIRST' }, 'first div text' );
    checkNode( "body|1 div", { textContent: 'SECOND' }, 'first div text' );
    doneTesting();
  }

body:
  textContent: x
  onLoad: c => test()
